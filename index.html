<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´ªæ°´ãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ— - å›½ç®¡ç†æ²³å·ãƒ»GeoJSONå¯¾å¿œ</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .control-group select,
        .control-group input[type="range"],
        .control-group input[type="file"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .control-group input[type="range"] {
            height: 6px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .opacity-value {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            margin-top: 5px;
        }
        
        .geojson-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #e9ecef;
        }
        
        .geojson-controls h4 {
            margin-bottom: 10px;
            color: #495057;
            font-size: 16px;
        }
        
        .geojson-layer-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        
        .geojson-layer-info {
            flex: 1;
            margin-right: 10px;
        }
        
        .geojson-layer-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
        }
        
        .geojson-layer-details {
            font-size: 12px;
            color: #666;
        }
        
        .geojson-layer-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .geojson-layer-controls button {
            padding: 4px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-remove {
            background: #dc3545;
            color: white;
        }
        
        .btn-remove:hover {
            background: #c82333;
        }
        
        .btn-toggle {
            background: #28a745;
            color: white;
        }
        
        .btn-toggle:hover {
            background: #218838;
        }
        
        .btn-toggle.hidden {
            background: #6c757d;
        }
        
        .map-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        #map {
            height: 1200px;
            width: 100%;
        }
        
        .info-panel {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .legend, .info {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex: 1;
        }
        
        .legend h3, .info h3 {
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }
        
        .legend-text {
            font-size: 14px;
            color: #666;
        }
        
        .info p {
            margin-bottom: 8px;
            line-height: 1.6;
            color: #666;
        }
        
        .info a {
            color: #667eea;
            text-decoration: none;
        }
        
        .info a:hover {
            text-decoration: underline;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .container {
                padding: 10px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .control-group {
                min-width: 100%;
            }
            
            #map {
                height: 400px;
            }
            
            .info-panel {
                flex-direction: column;
            }
            
            .geojson-layer-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .geojson-layer-controls {
                margin-top: 8px;
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸŒŠ æ´ªæ°´ãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ—</h1>
        <p>æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸï¼ˆæƒ³å®šæœ€å¤§è¦æ¨¡ï¼‰- å›½ç®¡ç†æ²³å·ãƒ»éƒ½é“åºœçœŒç®¡ç†æ²³å·ãƒ»GeoJSONå¯¾å¿œ</p>
    </div>
    
    <div class="container">
        <div class="controls">
            <div class="control-group">
                <label for="baseMap">ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—:</label>
                <select id="baseMap">
                    <option value="std">åœ°ç†é™¢åœ°å›³ï¼ˆæ¨™æº–ï¼‰</option>
                    <option value="pale">åœ°ç†é™¢åœ°å›³ï¼ˆæ·¡è‰²ï¼‰</option>
                    <option value="blank">åœ°ç†é™¢åœ°å›³ï¼ˆç™½åœ°å›³ï¼‰</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="opacity">æ´ªæ°´ãƒã‚¶ãƒ¼ãƒ‰ã®é€æ˜åº¦: <span id="opacityValue">0.7</span></label>
                <input type="range" id="opacity" min="0.1" max="1.0" step="0.1" value="0.7">
            </div>
            
            <div class="control-group">
                <label for="floodLayer">æ´ªæ°´ãƒã‚¶ãƒ¼ãƒ‰ãƒ¬ã‚¤ãƒ¤ãƒ¼:</label>
                <select id="floodLayer">
                    <option value="pref_46">éƒ½é“åºœçœŒç®¡ç†æ²³å· - é¹¿å…å³¶çœŒ</option>
                    <option value="pref_01">éƒ½é“åºœçœŒç®¡ç†æ²³å· - åŒ—æµ·é“</option>
                    <option value="pref_02">éƒ½é“åºœçœŒç®¡ç†æ²³å· - é’æ£®çœŒ</option>
                    <option value="pref_03">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å²©æ‰‹çœŒ</option>
                    <option value="pref_04">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å®®åŸçœŒ</option>
                    <option value="pref_05">éƒ½é“åºœçœŒç®¡ç†æ²³å· - ç§‹ç”°çœŒ</option>
                    <option value="pref_06">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å±±å½¢çœŒ</option>
                    <option value="pref_07">éƒ½é“åºœçœŒç®¡ç†æ²³å· - ç¦å³¶çœŒ</option>
                    <option value="pref_08">éƒ½é“åºœçœŒç®¡ç†æ²³å· - èŒ¨åŸçœŒ</option>
                    <option value="pref_09">éƒ½é“åºœçœŒç®¡ç†æ²³å· - æ ƒæœ¨çœŒ</option>
                    <option value="pref_10">éƒ½é“åºœçœŒç®¡ç†æ²³å· - ç¾¤é¦¬çœŒ</option>
                    <option value="pref_11">éƒ½é“åºœçœŒç®¡ç†æ²³å· - åŸ¼ç‰çœŒ</option>
                    <option value="pref_12">éƒ½é“åºœçœŒç®¡ç†æ²³å· - åƒè‘‰çœŒ</option>
                    <option value="pref_13">éƒ½é“åºœçœŒç®¡ç†æ²³å· - æ±äº¬éƒ½</option>
                    <option value="pref_14">éƒ½é“åºœçœŒç®¡ç†æ²³å· - ç¥å¥ˆå·çœŒ</option>
                    <option value="pref_15">éƒ½é“åºœçœŒç®¡ç†æ²³å· - æ–°æ½ŸçœŒ</option>
                    <option value="pref_16">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å¯Œå±±çœŒ</option>
                    <option value="pref_17">éƒ½é“åºœçœŒç®¡ç†æ²³å· - çŸ³å·çœŒ</option>
                    <option value="pref_18">éƒ½é“åºœçœŒç®¡ç†æ²³å· - ç¦äº•çœŒ</option>
                    <option value="pref_19">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å±±æ¢¨çœŒ</option>
                    <option value="pref_20">éƒ½é“åºœçœŒç®¡ç†æ²³å· - é•·é‡çœŒ</option>
                    <option value="pref_21">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å²é˜œçœŒ</option>
                    <option value="pref_22">éƒ½é“åºœçœŒç®¡ç†æ²³å· - é™å²¡çœŒ</option>
                    <option value="pref_23">éƒ½é“åºœçœŒç®¡ç†æ²³å· - æ„›çŸ¥çœŒ</option>
                    <option value="pref_24">éƒ½é“åºœçœŒç®¡ç†æ²³å· - ä¸‰é‡çœŒ</option>
                    <option value="pref_25">éƒ½é“åºœçœŒç®¡ç†æ²³å· - æ»‹è³€çœŒ</option>
                    <option value="pref_26">éƒ½é“åºœçœŒç®¡ç†æ²³å· - äº¬éƒ½åºœ</option>
                    <option value="pref_27">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å¤§é˜ªåºœ</option>
                    <option value="pref_28">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å…µåº«çœŒ</option>
                    <option value="pref_29">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å¥ˆè‰¯çœŒ</option>
                    <option value="pref_30">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å’Œæ­Œå±±çœŒ</option>
                    <option value="pref_31">éƒ½é“åºœçœŒç®¡ç†æ²³å· - é³¥å–çœŒ</option>
                    <option value="pref_32">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å³¶æ ¹çœŒ</option>
                    <option value="pref_33">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å²¡å±±çœŒ</option>
                    <option value="pref_34">éƒ½é“åºœçœŒç®¡ç†æ²³å· - åºƒå³¶çœŒ</option>
                    <option value="pref_35">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å±±å£çœŒ</option>
                    <option value="pref_36">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å¾³å³¶çœŒ</option>
                    <option value="pref_37">éƒ½é“åºœçœŒç®¡ç†æ²³å· - é¦™å·çœŒ</option>
                    <option value="pref_38">éƒ½é“åºœçœŒç®¡ç†æ²³å· - æ„›åª›çœŒ</option>
                    <option value="pref_39">éƒ½é“åºœçœŒç®¡ç†æ²³å· - é«˜çŸ¥çœŒ</option>
                    <option value="pref_40">éƒ½é“åºœçœŒç®¡ç†æ²³å· - ç¦å²¡çœŒ</option>
                    <option value="pref_41">éƒ½é“åºœçœŒç®¡ç†æ²³å· - ä½è³€çœŒ</option>
                    <option value="pref_42">éƒ½é“åºœçœŒç®¡ç†æ²³å· - é•·å´çœŒ</option>
                    <option value="pref_43">éƒ½é“åºœçœŒç®¡ç†æ²³å· - ç†Šæœ¬çœŒ</option>
                    <option value="pref_44">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å¤§åˆ†çœŒ</option>
                    <option value="pref_45">éƒ½é“åºœçœŒç®¡ç†æ²³å· - å®®å´çœŒ</option>
                    <option value="pref_47">éƒ½é“åºœçœŒç®¡ç†æ²³å· - æ²–ç¸„çœŒ</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="floodToggle">éƒ½é“åºœçœŒç®¡ç†æ²³å·ã®è¡¨ç¤º:</label>
                <select id="floodToggle">
                    <option value="on">è¡¨ç¤º</option>
                    <option value="off">éè¡¨ç¤º</option>
                </select>
            </div>
            <div class="control-group">
                <label for="nationalToggle">å›½ç®¡ç†æ²³å·ã®è¡¨ç¤º:</label>
                <select id="nationalToggle">
                    <option value="on">è¡¨ç¤º</option>
                    <option value="off">éè¡¨ç¤º</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="autoZoom">
                    <input type="checkbox" id="autoZoom" style="margin-right: 8px;">
                    éƒ½é“åºœçœŒé¸æŠæ™‚ã«è‡ªå‹•ã‚ºãƒ¼ãƒ 
                </label>
            </div>
        </div>
        
        <!-- GeoJSONã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="geojson-controls">
            <h4>ğŸ“ GeoJSONãƒ•ã‚¡ã‚¤ãƒ«ã®è¿½åŠ </h4>
            <div class="control-group">
                <label for="geojsonFile">GeoJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ:</label>
                <input type="file" id="geojsonFile" accept=".geojson,.json" multiple>
            </div>
            <div id="geojsonLayers"></div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <div class="info-panel">
            <div class="legend">
                <h3>å‡¡ä¾‹</h3>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #800080;"></div>
                    <div class="legend-text">æµ¸æ°´æ·±20mä»¥ä¸Š</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff69b4;"></div>
                    <div class="legend-text">æµ¸æ°´æ·±10mä»¥ä¸Š20mæœªæº€</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff0000;"></div>
                    <div class="legend-text">æµ¸æ°´æ·±5mä»¥ä¸Š10mæœªæº€</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffb6c1;"></div>
                    <div class="legend-text">æµ¸æ°´æ·±3mä»¥ä¸Š5mæœªæº€</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffa500;"></div>
                    <div class="legend-text">æµ¸æ°´æ·±0.5mä»¥ä¸Š3mæœªæº€</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffa500; margin-left: 20px;"></div>
                    <div class="legend-text">æµ¸æ°´æ·±0.5mä»¥ä¸Š1mæœªæº€</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffff00; margin-left: 20px;"></div>
                    <div class="legend-text">æµ¸æ°´æ·±0.5mæœªæº€</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffff00; margin-left: 20px;"></div>
                    <div class="legend-text">æµ¸æ°´æ·±0.3mæœªæº€</div>
                </div>
            </div>
            
            <div class="info">
                <h3>ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹</h3>
                <p><strong>ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—:</strong> å›½åœŸåœ°ç†é™¢åœ°ç†é™¢åœ°å›³</p>
                <p><strong>ãƒã‚¶ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿:</strong> å›½åœŸäº¤é€šçœå„åœ°æ–¹æ•´å‚™å±€ç­‰ï¼ˆå›½ç®¡ç†æ²³å·ï¼‰ãƒ»éƒ½é“åºœçœŒï¼ˆéƒ½é“åºœçœŒç®¡ç†æ²³å·ï¼‰</p>
                <p><strong>å‡ºå…¸:</strong> <a href="https://disaportal.gsi.go.jp/hazardmapportal/hazardmap/copyright/opendata.html#l2shinsuishin_kuni" target="_blank">ãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ—ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆ</a></p>
                
                <h3 style="margin-top: 20px;">ä½¿ç”¨æ–¹æ³•</h3>
                <p>â€¢ <strong>ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠ:</strong> éƒ½é“åºœçœŒç®¡ç†æ²³å·ã‚’é¸æŠ</p>
                <p>â€¢ <strong>ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—åˆ‡ã‚Šæ›¿ãˆ:</strong> ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§åœ°å›³ã®ç¨®é¡ã‚’å¤‰æ›´</p>
                <p>â€¢ <strong>é€æ˜åº¦èª¿æ•´:</strong> ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§æ´ªæ°´ãƒã‚¶ãƒ¼ãƒ‰ã®é€æ˜åº¦ã‚’èª¿æ•´</p>
                <p>â€¢ <strong>éƒ½é“åºœçœŒç®¡ç†æ²³å·è¡¨ç¤º:</strong> é¸æŠã—ãŸéƒ½é“åºœçœŒã®ãƒã‚¶ãƒ¼ãƒ‰è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ</p>
                <p>â€¢ <strong>å›½ç®¡ç†æ²³å·è¡¨ç¤º:</strong> å›½ç®¡ç†æ²³å·ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ</p>
                <p>â€¢ <strong>è‡ªå‹•ã‚ºãƒ¼ãƒ :</strong> ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§éƒ½é“åºœçœŒé¸æŠæ™‚ã®è‡ªå‹•ã‚ºãƒ¼ãƒ ã‚’åˆ¶å¾¡</p>
                <p>â€¢ <strong>GeoJSONè¿½åŠ :</strong> ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã§GeoJSONãƒ‡ãƒ¼ã‚¿ã‚’åœ°å›³ã«é‡ç•³</p>
                <p>â€¢ <strong>åœ°å›³æ“ä½œ:</strong> ãƒã‚¦ã‚¹ã§ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³æ“ä½œ</p>
                
                <h3 style="margin-top: 20px;">æ³¨æ„äº‹é …</h3>
                <p>â€¢ ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯æƒ³å®šæœ€å¤§è¦æ¨¡ã®æ´ªæ°´ã‚’æƒ³å®šã—ãŸã‚‚ã®ã§ã™</p>
                <p>â€¢ å®Ÿéš›ã®ç½å®³æ™‚ã«ã¯ã€æœ€æ–°ã®æ°—è±¡æƒ…å ±ã‚„é¿é›£æŒ‡ç¤ºã«å¾“ã£ã¦ãã ã•ã„</p>
                <p>â€¢ å›½ç®¡ç†æ²³å·ã¨éƒ½é“åºœçœŒç®¡ç†æ²³å·ã¯ç•°ãªã‚‹ç®¡ç†ä¸»ä½“ã®ãƒ‡ãƒ¼ã‚¿ã§ã™</p>
                <p>â€¢ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç™½åœ°å›³ãŒè¡¨ç¤ºã•ã‚Œã€æ´ªæ°´ãƒã‚¶ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®è¦–èªæ€§ãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ã¾ã™</p>
                <p>â€¢ è‡ªå‹•ã‚ºãƒ¼ãƒ ã‚’ã‚ªãƒ•ã«ã™ã‚‹ã¨ã€ç¾åœ¨ã®åœ°å›³ä½ç½®ã‚’ç¶­æŒã—ãŸã¾ã¾ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆã§ãã¾ã™</p>
                <p>â€¢ GeoJSONãƒ•ã‚¡ã‚¤ãƒ«ã¯æ¨™æº–çš„ãªGeoJSONå½¢å¼ã«å¯¾å¿œã—ã¦ã„ã¾ã™</p>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Â© 2024 æ´ªæ°´ãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ— - å›½åœŸåœ°ç†é™¢ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨</p>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // ãƒãƒƒãƒ—ã®åˆæœŸåŒ–ï¼ˆæ—¥æœ¬ã®ä¸­å¿ƒåº§æ¨™ï¼‰
        const map = L.map('map').setView([31.5602, 130.5581], 8);
        
        // GeoJSONãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†
        const geojsonLayers = new Map();
        let geojsonLayerCounter = 0;
        
        // éƒ½é“åºœçœŒã®ä¸­å¿ƒåº§æ¨™ã¨ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«
        const prefectureCenters = {
            "01": [43.0644, 141.3468, 7], // åŒ—æµ·é“
            "02": [40.8244, 140.7400, 8], // é’æ£®çœŒ
            "03": [39.7036, 141.1527, 8], // å²©æ‰‹çœŒ
            "04": [38.2682, 140.8721, 8], // å®®åŸçœŒ
            "05": [39.7186, 140.1024, 8], // ç§‹ç”°çœŒ
            "06": [38.2404, 140.3633, 8], // å±±å½¢çœŒ
            "07": [37.7503, 140.4676, 8], // ç¦å³¶çœŒ
            "08": [36.3418, 140.4468, 8], // èŒ¨åŸçœŒ
            "09": [36.5658, 139.8836, 8], // æ ƒæœ¨çœŒ
            "10": [36.3911, 139.0608, 8], // ç¾¤é¦¬çœŒ
            "11": [35.8617, 139.6455, 8], // åŸ¼ç‰çœŒ
            "12": [35.6051, 140.1233, 8], // åƒè‘‰çœŒ
            "13": [35.6762, 139.6503, 9], // æ±äº¬éƒ½
            "14": [35.4478, 139.6425, 8], // ç¥å¥ˆå·çœŒ
            "15": [37.9024, 139.0236, 8], // æ–°æ½ŸçœŒ
            "16": [36.6959, 137.2113, 8], // å¯Œå±±çœŒ
            "17": [36.5946, 136.6256, 8], // çŸ³å·çœŒ
            "18": [35.9432, 136.1886, 8], // ç¦äº•çœŒ
            "19": [35.6638, 138.5683, 8], // å±±æ¢¨çœŒ
            "20": [36.6513, 138.1810, 8], // é•·é‡çœŒ
            "21": [35.3912, 136.7223, 8], // å²é˜œçœŒ
            "22": [34.9769, 138.3830, 8], // é™å²¡çœŒ
            "23": [35.1802, 136.9066, 8], // æ„›çŸ¥çœŒ
            "24": [34.7303, 136.5086, 8], // ä¸‰é‡çœŒ
            "25": [35.0045, 135.8687, 8], // æ»‹è³€çœŒ
            "26": [35.0211, 135.7556, 8], // äº¬éƒ½åºœ
            "27": [34.6863, 135.5200, 8], // å¤§é˜ªåºœ
            "28": [34.6913, 135.1830, 8], // å…µåº«çœŒ
            "29": [34.6851, 135.8328, 8], // å¥ˆè‰¯çœŒ
            "30": [34.2261, 135.1675, 8], // å’Œæ­Œå±±çœŒ
            "31": [35.5038, 134.2384, 8], // é³¥å–çœŒ
            "32": [35.4723, 133.0505, 8], // å³¶æ ¹çœŒ
            "33": [34.6617, 133.9349, 8], // å²¡å±±çœŒ
            "34": [34.3963, 132.4596, 8], // åºƒå³¶çœŒ
            "35": [34.1859, 131.4706, 8], // å±±å£çœŒ
            "36": [34.0658, 134.5594, 8], // å¾³å³¶çœŒ
            "37": [34.3401, 134.0434, 8], // é¦™å·çœŒ
            "38": [33.8416, 132.7658, 8], // æ„›åª›çœŒ
            "39": [33.5597, 133.5311, 8], // é«˜çŸ¥çœŒ
            "40": [33.6064, 130.4181, 8], // ç¦å²¡çœŒ
            "41": [33.2494, 130.2989, 8], // ä½è³€çœŒ
            "42": [32.7503, 129.8777, 8], // é•·å´çœŒ
            "43": [32.7898, 130.7417, 8], // ç†Šæœ¬çœŒ
            "44": [33.2382, 131.6126, 8], // å¤§åˆ†çœŒ
            "45": [31.9111, 131.4239, 8], // å®®å´çœŒ
            "46": [31.5966, 130.5571, 8], // é¹¿å…å³¶çœŒ
            "47": [26.2124, 127.6809, 8]  // æ²–ç¸„çœŒ
        };
        
        // ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å®šç¾©
        const baseMaps = {
            std: L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
                attribution: 'åœ°ç†é™¢åœ°å›³',
                maxZoom: 18
            }),
            pale: L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', {
                attribution: 'åœ°ç†é™¢åœ°å›³ï¼ˆæ·¡è‰²ï¼‰',
                maxZoom: 18
            }),
            blank: L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/blank/{z}/{x}/{y}.png', {
                attribution: 'åœ°ç†é™¢åœ°å›³ï¼ˆç™½åœ°å›³ï¼‰',
                maxZoom: 18
            })
        };
        
        // ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ´ªæ°´ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆåˆæœŸã¯é¹¿å…å³¶çœŒï¼‰
        let currentFloodLayer = L.tileLayer('https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_pref_data/46/{z}/{x}/{y}.png', {
            attribution: 'æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸï¼ˆæƒ³å®šæœ€å¤§è¦æ¨¡ï¼‰- é¹¿å…å³¶çœŒéƒ½é“åºœçœŒç®¡ç†æ²³å·',
            opacity: 0.7,
            maxZoom: 17
        });

        // å›½ç®¡ç†æ²³å·ãƒ¬ã‚¤ãƒ¤ãƒ¼
        let nationalFloodLayer = L.tileLayer('https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_kuni_data/{z}/{x}/{y}.png', {
            attribution: 'æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸï¼ˆæƒ³å®šæœ€å¤§è¦æ¨¡ï¼‰- å›½ç®¡ç†æ²³å·',
            opacity: 0.7,
            maxZoom: 17
        });
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’è¿½åŠ ï¼ˆç™½åœ°å›³ï¼‰
        baseMaps.blank.addTo(map);
        currentFloodLayer.addTo(map);
        nationalFloodLayer.addTo(map);
        
        // GeoJSONãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å‡¦ç†
        function handleGeoJSONFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const geojsonData = JSON.parse(e.target.result);
                    addGeoJSONLayer(geojsonData, file.name);
                } catch (error) {
                    alert('GeoJSONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        // GeoJSONãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ 
        function addGeoJSONLayer(geojsonData, fileName) {
            const layerId = 'geojson_' + geojsonLayerCounter++;
            
            // ãƒ©ãƒ³ãƒ€ãƒ ãªè‰²ã‚’ç”Ÿæˆ
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ff8800', '#8800ff', '#0088ff', '#ff0088'];
            const color = colors[geojsonLayerCounter % colors.length];
            
            // GeoJSONãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆ
            const geojsonLayer = L.geoJSON(geojsonData, {
                style: {
                    fillColor: color,
                    weight: 2,
                    opacity: 1,
                    color: color,
                    fillOpacity: 0.3
                },
                onEachFeature: function(feature, layer) {
                    if (feature.properties) {
                        const popupContent = Object.keys(feature.properties)
                            .map(key => `<strong>${key}:</strong> ${feature.properties[key]}`)
                            .join('<br>');
                        layer.bindPopup(popupContent);
                    }
                }
            });
            
            // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒãƒƒãƒ—ã«è¿½åŠ 
            geojsonLayer.addTo(map);
            
            // ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’ä¿å­˜
            geojsonLayers.set(layerId, {
                layer: geojsonLayer,
                name: fileName,
                visible: true,
                color: color,
                featureCount: geojsonData.features ? geojsonData.features.length : 0
            });
            
            // UIã«ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’è¿½åŠ 
            addGeoJSONLayerUI(layerId, fileName, color, geojsonData.features ? geojsonData.features.length : 0);
            
            // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç¯„å›²ã«ã‚ºãƒ¼ãƒ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
            if (geojsonLayer.getBounds().isValid()) {
                map.fitBounds(geojsonLayer.getBounds());
            }
        }
        
        // GeoJSONãƒ¬ã‚¤ãƒ¤ãƒ¼UIè¿½åŠ 
        function addGeoJSONLayerUI(layerId, fileName, color, featureCount) {
            const layersContainer = document.getElementById('geojsonLayers');
            const layerItem = document.createElement('div');
            layerItem.className = 'geojson-layer-item';
            layerItem.id = 'layer_' + layerId;
            
            layerItem.innerHTML = `
                <div class="geojson-layer-info">
                    <div class="geojson-layer-name">${fileName}</div>
                    <div class="geojson-layer-details">
                        è‰²: <span style="color: ${color};">â– </span> | 
                        ãƒ•ã‚£ãƒ¼ãƒãƒ£æ•°: ${featureCount}
                    </div>
                </div>
                <div class="geojson-layer-controls">
                    <button class="btn-toggle" onclick="toggleGeoJSONLayer('${layerId}')">éè¡¨ç¤º</button>
                    <button class="btn-remove" onclick="removeGeoJSONLayer('${layerId}')">å‰Šé™¤</button>
                </div>
            `;
            
            layersContainer.appendChild(layerItem);
        }
        
        // GeoJSONãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleGeoJSONLayer(layerId) {
            const layerInfo = geojsonLayers.get(layerId);
            if (!layerInfo) return;
            
            const button = document.querySelector(`#layer_${layerId} .btn-toggle`);
            
            if (layerInfo.visible) {
                map.removeLayer(layerInfo.layer);
                layerInfo.visible = false;
                button.textContent = 'è¡¨ç¤º';
                button.classList.add('hidden');
            } else {
                map.addLayer(layerInfo.layer);
                layerInfo.visible = true;
                button.textContent = 'éè¡¨ç¤º';
                button.classList.remove('hidden');
            }
        }
        
        // GeoJSONãƒ¬ã‚¤ãƒ¤ãƒ¼å‰Šé™¤
        function removeGeoJSONLayer(layerId) {
            const layerInfo = geojsonLayers.get(layerId);
            if (!layerInfo) return;
            
            map.removeLayer(layerInfo.layer);
            geojsonLayers.delete(layerId);
            
            const layerItem = document.getElementById('layer_' + layerId);
            if (layerItem) {
                layerItem.remove();
            }
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('geojsonFile').addEventListener('change', function(e) {
            const files = e.target.files;
            for (let file of files) {
                if (file.type === 'application/json' || file.name.endsWith('.geojson') || file.name.endsWith('.json')) {
                    handleGeoJSONFile(file);
                } else {
                    alert('GeoJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„: ' + file.name);
                }
            }
            // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
            e.target.value = '';
        });
        
        // ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—åˆ‡ã‚Šæ›¿ãˆ
        document.getElementById('baseMap').addEventListener('change', function() {
            const selectedMap = this.value;
            
            // ç¾åœ¨ã®ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’å‰Šé™¤
            Object.values(baseMaps).forEach(layer => {
                map.removeLayer(layer);
            });
            
            // æ–°ã—ã„ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’è¿½åŠ 
            baseMaps[selectedMap].addTo(map);
            
            // ãƒã‚¶ãƒ¼ãƒ‰ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å†è¿½åŠ ï¼ˆè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿ï¼‰
            if (document.getElementById('floodToggle').value === 'on') {
                currentFloodLayer.addTo(map);
            }
            if (document.getElementById('nationalToggle').value === 'on') {
                nationalFloodLayer.addTo(map);
            }
            
            // GeoJSONãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å†è¿½åŠ ï¼ˆè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿ï¼‰
            geojsonLayers.forEach((layerInfo, layerId) => {
                if (layerInfo.visible) {
                    map.addLayer(layerInfo.layer);
                }
            });
        });
        
        // æ´ªæ°´ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
        document.getElementById('floodLayer').addEventListener('change', function() {
            const selectedLayer = this.value;
            
            // ç¾åœ¨ã®åœ°å›³ã®ä¸­å¿ƒã¨ã‚ºãƒ¼ãƒ ã‚’ä¿å­˜
            const currentCenter = map.getCenter();
            const currentZoom = map.getZoom();
            
            // ç¾åœ¨ã®æ´ªæ°´ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å‰Šé™¤
            map.removeLayer(currentFloodLayer);
            
            // éƒ½é“åºœçœŒç®¡ç†æ²³å·ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆ
            const prefCode = selectedLayer.replace('pref_', '');
            const prefName = document.querySelector(`option[value="${selectedLayer}"]`).textContent.split(' - ')[1];
            
            currentFloodLayer = L.tileLayer(`https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_pref_data/${prefCode}/{z}/{x}/{y}.png`, {
                attribution: `æ´ªæ°´æµ¸æ°´æƒ³å®šåŒºåŸŸï¼ˆæƒ³å®šæœ€å¤§è¦æ¨¡ï¼‰- ${prefName}éƒ½é“åºœçœŒç®¡ç†æ²³å·`,
                opacity: parseFloat(document.getElementById('opacity').value),
                maxZoom: 17
            });
            
            // æ–°ã—ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ ï¼ˆè¡¨ç¤ºãŒã‚ªãƒ³ã®å ´åˆã®ã¿ï¼‰
            if (document.getElementById('floodToggle').value === 'on') {
                currentFloodLayer.addTo(map);
            }
            
            // è‡ªå‹•ã‚ºãƒ¼ãƒ ãŒæœ‰åŠ¹ãªå ´åˆã®ã¿ã‚ºãƒ¼ãƒ 
            if (document.getElementById('autoZoom').checked) {
                if (prefectureCenters[prefCode]) {
                    const [lat, lng, zoom] = prefectureCenters[prefCode];
                    map.setView([lat, lng], zoom);
                }
            } else {
                // è‡ªå‹•ã‚ºãƒ¼ãƒ ãŒç„¡åŠ¹ã®å ´åˆã¯ç¾åœ¨ã®ä½ç½®ã‚’ç¶­æŒ
                map.setView(currentCenter, currentZoom);
            }
        });
        
        // é€æ˜åº¦èª¿æ•´
        document.getElementById('opacity').addEventListener('input', function() {
            const opacity = parseFloat(this.value);
            currentFloodLayer.setOpacity(opacity);
            nationalFloodLayer.setOpacity(opacity);
            document.getElementById('opacityValue').textContent = opacity.toFixed(1);
        });
        
        // æ´ªæ°´ãƒã‚¶ãƒ¼ãƒ‰è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        document.getElementById('floodToggle').addEventListener('change', function() {
            const isVisible = this.value === 'on';
            
            if (isVisible) {
                if (!map.hasLayer(currentFloodLayer)) {
                    currentFloodLayer.addTo(map);
                }
            } else {
                if (map.hasLayer(currentFloodLayer)) {
                    map.removeLayer(currentFloodLayer);
                }
            }
        });

        // å›½ç®¡ç†æ²³å·è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        document.getElementById('nationalToggle').addEventListener('change', function() {
            const isVisible = this.value === 'on';
            
            if (isVisible) {
                if (!map.hasLayer(nationalFloodLayer)) {
                    nationalFloodLayer.addTo(map);
                }
            } else {
                if (map.hasLayer(nationalFloodLayer)) {
                    map.removeLayer(nationalFloodLayer);
                }
            }
        });
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
        window.addEventListener('resize', function() {
            map.invalidateSize();
        });
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        map.on('tileerror', function(e) {
            console.log('ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
        });
        
        // åœ°å›³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®åº§æ¨™è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        map.on('click', function(e) {
            console.log('ã‚¯ãƒªãƒƒã‚¯åº§æ¨™:', e.latlng);
        });
    </script>
</body>
</html>
