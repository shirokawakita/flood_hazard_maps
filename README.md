# 洪水ハザードマップ - 都道府県管理河川・国管理河川

国土地理院のハザードマップポータルサイトから提供されている**洪水浸水想定区域（想定最大規模）**のデータを、地理院地図上に表示するHTMLアプリケーションです。全47都道府県の都道府県管理河川のデータを選択して表示でき、国管理河川の表示/非表示も独立して切り替え可能です。

## 🌟 機能

- **地理院地図ベースマップ**: 標準、淡色、白地図の3種類から選択
- **洪水ハザードレイヤー選択**: 全47都道府県の都道府県管理河川から選択（初期は鹿児島県）
- **地図位置維持機能**: レイヤー切り替え時に現在の地図位置とズームを維持
- **自動ズーム機能**: 都道府県選択時に自動的にその地域にズーム（オプション）
- **透明度調整**: スライダーで0.1〜1.0の範囲で調整可能（両レイヤーに同時適用）
- **都道府県管理河川表示切り替え**: 選択した都道府県のハザード表示/非表示を切り替え
- **国管理河川表示切り替え**: 国管理河川の表示/非表示を切り替え
- **独立レイヤー制御**: 都道府県管理河川と国管理河川を個別に表示制御
- **レスポンシブデザイン**: モバイル・タブレット対応
- **直感的なUI**: モダンなデザインと使いやすいコントロール

## 🚀 使用方法

### 1. ブラウザで直接開く
```bash
open index.html
```

### 2. ローカルサーバーで起動（推奨）
```bash
# Python 3の場合
python -m http.server 8000

# Node.jsの場合
npx http-server

# その後、ブラウザで http://localhost:8000 にアクセス
```

### 3. 起動スクリプトを使用（最も簡単）
```bash
# Pythonスクリプトで起動（自動でブラウザが開きます）
python start_server.py
# 自動的にブラウザが開き、鹿児島県中心の地図が表示されます
```

## 🛠️ 技術仕様

- **フレームワーク**: なし（純粋なHTML/CSS/JavaScript）
- **地図ライブラリ**: Leaflet.js 1.9.4
- **タイルサーバー**: 国土地理院地理院タイル
- **ハザードデータ**: 国土地理院ハザードマップポータルサイト
- **対応ブラウザ**: Chrome 60以上、Firefox 55以上、Safari 12以上、Edge 79以上
- **レスポンシブ対応**: モバイル・タブレット・デスクトップ対応

## 📊 データソース

- **ベースマップ**: 国土地理院地理院地図（標準・淡色・白地図）
- **ハザードデータ（国管理河川）**: 国土交通省各地方整備局等
- **ハザードデータ（都道府県管理河川）**: 各都道府県
- **出典**: [ハザードマップポータルサイト](https://disaportal.gsi.go.jp/hazardmapportal/hazardmap/copyright/opendata.html#l2shinsuishin_kuni)

### 使用タイルURL

- **国管理河川データ**: `https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_kuni_data/{z}/{x}/{y}.png`
- **都道府県管理河川データ**: `https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_pref_data/{県コード}/{z}/{x}/{y}.png`

### 都道府県コード一覧

| 都道府県 | コード | 都道府県 | コード | 都道府県 | コード |
|---------|--------|---------|--------|---------|--------|
| 北海道 | 01 | 東京都 | 13 | 滋賀県 | 25 |
| 青森県 | 02 | 神奈川県 | 14 | 京都府 | 26 |
| 岩手県 | 03 | 新潟県 | 15 | 大阪府 | 27 |
| 宮城県 | 04 | 富山県 | 16 | 兵庫県 | 28 |
| 秋田県 | 05 | 石川県 | 17 | 奈良県 | 29 |
| 山形県 | 06 | 福井県 | 18 | 和歌山県 | 30 |
| 福島県 | 07 | 山梨県 | 19 | 鳥取県 | 31 |
| 茨城県 | 08 | 長野県 | 20 | 島根県 | 32 |
| 栃木県 | 09 | 岐阜県 | 21 | 岡山県 | 33 |
| 群馬県 | 10 | 静岡県 | 22 | 広島県 | 34 |
| 埼玉県 | 11 | 愛知県 | 23 | 山口県 | 35 |
| 千葉県 | 12 | 三重県 | 24 | 徳島県 | 36 |

| 都道府県 | コード | 都道府県 | コード | 都道府県 | コード |
|---------|--------|---------|--------|---------|--------|
| 香川県 | 37 | 佐賀県 | 41 | 宮崎県 | 45 |
| 愛媛県 | 38 | 長崎県 | 42 | 鹿児島県 | 46 |
| 高知県 | 39 | 熊本県 | 43 | 沖縄県 | 47 |
| 福岡県 | 40 | 大分県 | 44 |  |  |

## 🎨 凡例

洪水浸水想定区域は以下の色で表示されます：
- **紫色 (#800080)**: 浸水深20m以上
- **ピンク (#ff69b4)**: 浸水深10m以上20m未満
- **赤色 (#ff0000)**: 浸水深5m以上10m未満
- **薄いピンク (#ffb6c1)**: 浸水深3m以上5m未満
- **オレンジ (#ffa500)**: 浸水深0.5m以上3m未満
- **オレンジ（段階） (#ffa500)**: 浸水深0.5m以上1m未満
- **黄色 (#ffff00)**: 浸水深0.5m未満
- **黄色（段階） (#ffff00)**: 浸水深0.3m未満

## 🎮 操作方法

1. **洪水レイヤー選択**: 都道府県管理河川を選択
2. **ベースマップ切り替え**: ドロップダウンで地図の種類を変更（標準・淡色・白地図）
3. **透明度調整**: スライダーで洪水ハザードの透明度を調整
4. **都道府県管理河川表示**: 選択した都道府県のハザード表示/非表示を切り替え
5. **国管理河川表示**: 国管理河川の表示/非表示を切り替え
6. **自動ズーム制御**: チェックボックスで都道府県選択時の自動ズームをオン/オフ
7. **地図操作**: マウスでズーム・パン操作

### 詳細な操作手順

#### 基本的な使用方法
1. ブラウザでアプリケーションを開く（初期表示：鹿児島県中心、白地図）
2. 「洪水ハザードレイヤー」で表示したい都道府県を選択
3. 「ベースマップ」で地図の種類を選択（標準・淡色・白地図から選択）
4. 「透明度」スライダーでハザードデータの透明度を調整（両レイヤーに適用）
5. 「都道府県管理河川の表示」で選択した都道府県のハザード表示/非表示を切り替え
6. 「国管理河川の表示」で国管理河川の表示/非表示を切り替え
7. 「都道府県選択時に自動ズーム」で自動ズーム機能を制御

#### 地図位置の維持
- デフォルトでは、レイヤー切り替え時に現在の地図位置とズームが維持されます
- 特定の地域を見たい場合は、地図を移動・ズームしてからレイヤーを切り替えてください

#### 自動ズーム機能
- 「都道府県選択時に自動ズーム」にチェックを入れると、都道府県選択時に自動的にその地域の中心座標とズームレベルに移動します
- チェックを外すと、現在の地図位置を維持したままレイヤーが切り替わります
- 各都道府県の最適な表示位置とズームレベルが事前に設定されています

#### ベースマップの選択
- **地理院地図（標準）**: 通常の地理院地図、洪水ハザードデータとの視認性が良好
- **地理院地図（淡色）**: 淡い色調の地図、ハザードデータが目立ちやすい
- **地理院地図（白地図）**: 白地図ベース、ハザードデータの色が最も見やすい（デフォルト）

## ⚠️ 注意事項

### データについて
- このデータは想定最大規模の洪水を想定したものです
- 実際の災害時には、最新の気象情報や避難指示に従ってください
- 国管理河川と都道府県管理河川は異なる管理主体のデータです
- 一部の都道府県ではデータが利用できない場合があります

### 技術的な注意事項
- CORSポリシーの関係で、ローカルサーバーでの起動を推奨します
- ブラウザのキャッシュが原因で古いデータが表示される場合があります
- モバイルデバイスでは、タッチ操作で地図の移動・ズームが可能です

### 使用方法について
- 自動ズームをオフにすると、現在の地図位置を維持したままレイヤーを切り替えできます
- 複数の都道府県を比較したい場合は、地図位置を固定してからレイヤーを切り替えてください
- デフォルトで白地図が表示され、洪水ハザードデータの視認性が最適化されています
- 国管理河川と都道府県管理河川を独立して表示制御できるため、比較分析が容易です
- 透明度調整は両方のレイヤーに同時に適用されます
- 初期表示は鹿児島県中心で設定されており、九州地方の洪水ハザードを確認しやすい構成になっています

## 🔧 カスタマイズ

### タイルURLの変更
洪水ハザードデータのタイルURLを変更する場合は、以下の部分を編集してください：

```javascript
// 国管理河川レイヤー
currentFloodLayer = L.tileLayer('https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_kuni_data/{z}/{x}/{y}.png', {
    attribution: '洪水浸水想定区域（想定最大規模）- 国管理河川',
    opacity: parseFloat(document.getElementById('opacity').value),
    maxZoom: 17
});

// 都道府県管理河川レイヤー
currentFloodLayer = L.tileLayer(`https://disaportaldata.gsi.go.jp/raster/01_flood_l2_shinsuishin_pref_data/${prefCode}/{z}/{x}/{y}.png`, {
    attribution: `洪水浸水想定区域（想定最大規模）- ${prefName}都道府県管理河川`,
    opacity: parseFloat(document.getElementById('opacity').value),
    maxZoom: 17
});
```

### 新しいレイヤーの追加
新しい洪水レイヤーを追加する場合は、以下の手順で実装してください：

1. HTMLの`<select>`要素に新しい`<option>`を追加
2. JavaScriptのレイヤー切り替え処理に新しい条件分岐を追加
3. 必要に応じて都道府県の中心座標を`prefectureCenters`オブジェクトに追加

### スタイルの変更
CSSファイルを編集することで、デザインをカスタマイズできます。主要なスタイルクラス：

- `.header`: ヘッダー部分のスタイル
- `.controls`: コントロールパネルのスタイル
- `.map-container`: 地図コンテナのスタイル
- `.legend`: 凡例のスタイル
- `.info`: 情報パネルのスタイル

## 🌐 ブラウザ対応

- Chrome 60以上
- Firefox 55以上
- Safari 12以上
- Edge 79以上

## 📱 モバイル対応

- レスポンシブデザイン対応
- タッチ操作対応
- モバイルブラウザ最適化

## 🔒 ライセンス

このプロジェクトはMITライセンスの下で公開されています。
